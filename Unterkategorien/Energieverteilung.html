<!DOCTYPE html>
<html lang="de">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="/AufnameApp/css/style.css">
	<script src="/AufnameApp/js/fields.js"></script>
	<script src="/AufnameApp/js/speicher.js"></script>
	<script src="/AufnameApp/js/createLocation.js"></script>
	<script src="/AufnameApp/js/subpageStorage.js"></script>
	
	<title>Energieverteilung</title>

    <script src="/AufnameApp/js/Berechnung-kWh.js"></script>
    <script src="/AufnameApp/js/Berechnung-Ladepunkte.js"></script>
</head>
<body>
    <h1>Energieverteilung</h1>
    <p>Übersicht der Energieverteilungen (Unterseiten)</p>

    <button id="createSubpageBtn">Energieverteilung anlegen</button>
    <div id="subpagesOverview" class="subpages-overview"></div>

<button onclick="window.location.href='Standort.html'">Zurück zu Standort</button>
<button id="downloadLocationButton" data-download="true">Standort speichern</button>

<script>
	document.addEventListener('DOMContentLoaded', function () {
		const group = 'Energieverteilung';
		const fields = window.fieldGroups && window.fieldGroups[group] ? window.fieldGroups[group] : [];
		const createBtn = document.getElementById('createSubpageBtn');
		const overviewContainer = document.getElementById('subpagesOverview');

		function render() {
			const names = window.subpageStorage.getSubpageNames(group);
			overviewContainer.innerHTML = '';
			if (names.length === 0) {
				overviewContainer.textContent = 'Keine Unterseiten vorhanden.';
				return;
			}
			const ul = document.createElement('ul');
			names.forEach(name => {
				const li = document.createElement('li');
				const data = window.subpageStorage.getSubpage(group, name, fields);
				const lp = data['Anzahl Ladepunkte'] || '-';
				const summary = `${name} — ${lp} Punkte`;
				li.textContent = summary;

				const editLink = document.createElement('a');
				editLink.textContent = 'Bearbeiten';
				editLink.href = `Energieverteilung_edit.html?name=${encodeURIComponent(name)}`;
				editLink.style.marginLeft = '8px';

				const delBtn = document.createElement('button');
				delBtn.textContent = 'Löschen';
				delBtn.addEventListener('click', () => {
					if (confirm(`Energieverteilung "${name}" wirklich löschen?`)) {
						window.subpageStorage.deleteSubpage(group, name, fields);
						const updatedNames = window.subpageStorage.getSubpageNames(group);
						sessionStorage.setItem(`subpages_${group}_names`, JSON.stringify(updatedNames));
						render();
					}
				});

				li.appendChild(document.createTextNode(' '));
				li.appendChild(editLink);
				li.appendChild(document.createTextNode(' '));
				li.appendChild(delBtn);
				ul.appendChild(li);
			});
			overviewContainer.appendChild(ul);
		}

		createBtn.addEventListener('click', () => {
			window.location.href = 'Energieverteilung_edit.html';
		});

		render();
	});
</script>

</body>
</html>

