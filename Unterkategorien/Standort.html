<!DOCTYPE html>
<html lang="de">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="/AufnameApp/css/style.css"> <!-- Gleiche CSS Datei -->
	<script src="/AufnameApp/js/fields.js"></script>
	<script src="/AufnameApp/js/speicher.js"></script>
	
	<title>Standort</title>


</head>
<body>

	<label for="standortName">Standort Name:</label>
	<input type="text" id="standortName" placeholder="Standort eingeben">

	<label for="standortAdresse">Adresse:</label>
	<input type="text" id="standortAdresse" placeholder="Adresse eingeben">

	<label for="standortBemerkung">Bemerkung:</label>
	<input type="text" id="standortBemerkung" placeholder="Bemerkung hinzufügen">

    <!-- Hidden upload input: Übersicht/andere Seiten können diese auslösen -->
    <input type="file" id="uploadJsonStandort" accept="application/json" style="display:none">
	<!-- Upload-Steuerelement wird auf der Übersichtsseite getriggert; entfernt -->

	<div style="margin-top:12px;">
		<button onclick="window.location.href='Grundriss.html'">Grundriss</button>
		<button onclick="window.location.href='Hausanschluss.html'">Hausanschluss</button>
		<button onclick="window.location.href='Energieverteilung.html'">Energieverteilung</button>
	</div>

<p>
<button onclick="window.location.href='../index.html'">Zurück</button>
	
</body>
<script>
document.addEventListener('DOMContentLoaded', function() {
	const params = new URLSearchParams(window.location.search);
	const mode = params.get('mode') || 'create';

	// Upload wird von der Übersichtsseite getriggert; im Edit-Modus werden sessionStorage-Werte geladen

	// Falls schon ein Name in sessionStorage ist, anzeigen
	const name = sessionStorage.getItem('editLocationName');
	if (name) {
		const el = document.getElementById('standortName');
		if (el) el.value = name;
	}

	// Falls bereits eine ganze JSON im sessionStorage liegt, parsen und Felder befüllen
	const storedJson = sessionStorage.getItem('editLocationJson');
	if (storedJson) {
		try {
			const data = JSON.parse(storedJson);
			const locationValue = data.location ?? data.Location ?? data.name ?? null;
			if (locationValue) {
				const el = document.getElementById('standortName');
				if (el) el.value = locationValue;
			}
			const adresseValue = data.address ?? data.adresse ?? data.Address ?? null;
			if (adresseValue) {
				const a = document.getElementById('standortAdresse');
				if (a) a.value = adresseValue;
			}
			const bemerkungValue = data.remark ?? data.bemerkung ?? data.note ?? null;
			if (bemerkungValue) {
				const b = document.getElementById('standortBemerkung');
				if (b) b.value = bemerkungValue;
			}
		} catch (e) {
			// ignore parse errors
		}
	}

	// JSON-Upload im Bearbeiten-Modus verarbeiten
	const uploadInput = document.getElementById('uploadJsonStandort');
	if (uploadInput) {
		uploadInput.addEventListener('change', function(event){
			const file = event.target.files[0];
			if (!file) return;
			const reader = new FileReader();
			reader.onload = function(e){
				try {
					const data = JSON.parse(e.target.result);
					const locationValue = data.location ?? data.Location ?? data.name ?? null;
					if (locationValue) {
						sessionStorage.setItem('editLocationName', locationValue);
						try { sessionStorage.setItem('editLocationJson', JSON.stringify(data)); } catch (err) { }
						const el = document.getElementById('standortName');
						if (el) el.value = locationValue;
						// optionally fill other common fields if present in JSON
						const adresseValue = data.address ?? data.adresse ?? data.Address ?? null;
						if (adresseValue) {
							const a = document.getElementById('standortAdresse');
							if (a) a.value = adresseValue;
						}
						const bemerkungValue = data.remark ?? data.bemerkung ?? data.note ?? null;
						if (bemerkungValue) {
							const b = document.getElementById('standortBemerkung');
							if (b) b.value = bemerkungValue;
						}
					} else {
						alert('Keine "location"-Eigenschaft in der JSON-Datei gefunden.');
					}
				} catch (err) {
					alert('Fehler beim Einlesen der JSON-Datei: ' + err.message);
				}
			};
			reader.readAsText(file);
		});
	}
}
);