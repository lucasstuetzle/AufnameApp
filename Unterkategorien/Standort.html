<!DOCTYPE html>
<html lang="de">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="/AufnameApp/css/style.css"> <!-- Gleiche CSS Datei -->
	<script src="/AufnameApp/js/fields.js"></script>
	<script src="/AufnameApp/js/speicher.js"></script>
	
	<title>Grundriss</title>


</head>
<body>

	<label for="standortName">Standort Name:</label>
	<input type="text" id="standortName" placeholder="Standort eingeben">

	<label for="standortAdresse">Adresse:</label>
	<input type="text" id="standortAdresse" placeholder="Adresse eingeben">

	<label for="standortBemerkung">Bemerkung:</label>
	<input type="text" id="standortBemerkung" placeholder="Bemerkung hinzufügen">

	<div id="edit-upload" style="margin-top:10px; display:none;">
		<label for="uploadJsonStandort">JSON-Datei hochladen (Bearbeiten):</label>
		<input type="file" id="uploadJsonStandort" accept=".json">
	</div>

	<div style="margin-top:12px;">
		<button id="btnGrundriss">Grundriss</button>
		<button id="btnHausanschluss">Hausanschluss</button>
		<button id="btnEnergieverteilung">Energieverteilung</button>
	</div>

<p>
<button onclick="window.location.href='../index.html'">Zurück</button>
	
</body>
<script>
document.addEventListener('DOMContentLoaded', function() {
	const params = new URLSearchParams(window.location.search);
	const mode = params.get('mode') || 'create';

	// Wenn aus 'edit' aufgerufen, zeige Upload-Feld
	if (mode === 'edit') {
		const uploadDiv = document.getElementById('edit-upload');
		if (uploadDiv) uploadDiv.style.display = 'block';
	}

	// Falls schon ein Name in sessionStorage ist, anzeigen
	const name = sessionStorage.getItem('editLocationName');
	if (name) {
		const el = document.getElementById('standortName');
		if (el) el.value = name;
	}

	// JSON-Upload im Bearbeiten-Modus verarbeiten
	const uploadInput = document.getElementById('uploadJsonStandort');
	if (uploadInput) {
		uploadInput.addEventListener('change', function(event){
			const file = event.target.files[0];
			if (!file) return;
			const reader = new FileReader();
			reader.onload = function(e){
				try {
					const data = JSON.parse(e.target.result);
					const locationValue = data.location ?? data.Location ?? data.name ?? null;
					if (locationValue) {
						sessionStorage.setItem('editLocationName', locationValue);
						try { sessionStorage.setItem('editLocationJson', JSON.stringify(data)); } catch (err) { }
						const el = document.getElementById('standortName');
						if (el) el.value = locationValue;
					} else {
						alert('Keine "location"-Eigenschaft in der JSON-Datei gefunden.');
					}
				} catch (err) {
					alert('Fehler beim Einlesen der JSON-Datei: ' + err.message);
				}
			};
			reader.readAsText(file);
		});
	}
});
</script>

	// Navigation-Buttons: im Bearbeiten-Modus ist das Hochladen einer JSON-Datei erforderlich.
	const requireJsonWhenEditing = function(targetUrl) {
		if (mode === 'edit') {
			const hasJson = !!sessionStorage.getItem('editLocationJson') || !!sessionStorage.getItem('editLocationName');
			if (!hasJson) {
				alert('Bitte zunächst die JSON-Datei hochladen, um im Bearbeitungsmodus fortzufahren.');
				return false;
			}
		}
		return true;
	};

	const btnGrundriss = document.getElementById('btnGrundriss');
	const btnHausanschluss = document.getElementById('btnHausanschluss');
	const btnEnergieverteilung = document.getElementById('btnEnergieverteilung');

	if (btnGrundriss) btnGrundriss.addEventListener('click', function(){ if (requireJsonWhenEditing('Grundriss.html')) window.location.href = 'Grundriss.html'; });
	if (btnHausanschluss) btnHausanschluss.addEventListener('click', function(){ if (requireJsonWhenEditing('Hausanschluss.html')) window.location.href = 'Hausanschluss.html'; });
	if (btnEnergieverteilung) btnEnergieverteilung.addEventListener('click', function(){ if (requireJsonWhenEditing('Energieverteilung.html')) window.location.href = 'Energieverteilung.html'; });
</html>
