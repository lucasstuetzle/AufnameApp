<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/AufnameApp/css/style.css">
    <script src="/AufnameApp/js/fields.js"></script>
    <script src="/AufnameApp/js/subpageStorage.js"></script>
    <script src="/AufnameApp/js/Berechnung-kWh.js"></script>
    <script src="/AufnameApp/js/Berechnung-Ladepunkte.js"></script>
    <title>Energieverteilung — Editor</title>
</head>
<body>
    <h1>Energieverteilung (Unterseite)</h1>
    <form id="subpageForm">
        <label for="supply">Energiequelle:</label>
        <select id="supply">
            <option>Netzstrom</option>
            <option>Solar</option>
            <option>Wind</option>
            <option>Wasserkraft</option>
            <option>Batteriespeicher</option>
        </select>

        <label for="capacity">Kapazität (kW):</label>
        <input type="number" id="capacity" oninput="calculateEnergy()">

        <label for="time">Zeitdauer (h):</label>
        <input type="number" id="time" oninput="calculateEnergy()">

        <label for="energy">Energiemenge (kWh):</label>
        <input type="text" id="energy" readonly>

        <label for="Anzahl Ladepunkte">Anzahl Ladepunkte:</label>
        <input type="number" id="Anzahl Ladepunkte">

        <label for="lpMode">Modus:</label>
        <select id="lpMode">
            <option value="GLF">GLF</option>
            <option value="kW">kW/SP</option>
        </select>

        <label for="lpSlider">Wert:</label>
        <input type="range" id="lpSlider" min="0.1" max="1" step="0.1" value="1">
        <span id="lpSliderValue">1</span>

        <label for="requiredEnergy">Notwendige Energie (kW):</label>
        <input type="text" id="requiredEnergy" readonly>
    </form>

    <button id="saveSubpageBtn">Speichern</button>
    <button id="backBtn">Zurück</button>

    <script>
        (function(){
            const params = new URLSearchParams(window.location.search);
            const editName = params.get('name'); // for editing
            const group = 'Energieverteilung';
            const fields = window.fieldGroups && window.fieldGroups[group] ? window.fieldGroups[group] : ['supply','capacity','time','energy','Anzahl Ladepunkte','lpMode','lpSlider','requiredEnergy'];

            function populate() {
                if (!editName) return;
                const data = window.subpageStorage.getSubpage(group, editName, fields);
                for (const field in data) {
                    const el = document.getElementById(field);
                    if (el) el.value = data[field];
                }
            }

            document.getElementById('saveSubpageBtn').addEventListener('click', function(){
                // For Energieverteilung, use supply as name/identifier
                const supplyVal = document.getElementById('supply').value.trim();
                const capacityVal = document.getElementById('capacity').value.trim();
                const name = supplyVal && capacityVal ? `${supplyVal} ${capacityVal}` : (supplyVal || 'Energieverteilung');

                const data = {};
                fields.forEach(f => {
                    const el = document.getElementById(f);
                    if (el) data[f] = el.value || '';
                });

                window.subpageStorage.saveSubpage(group, name, data);
                const names = window.subpageStorage.getSubpageNames(group);
                sessionStorage.setItem(`subpages_${group}_names`, JSON.stringify(names));

                window.location.href = 'Energieverteilung.html';
            });

            document.getElementById('backBtn').addEventListener('click', function(){ window.location.href = 'Energieverteilung.html'; });

            populate();
        })();
    </script>
</body>
</html>
