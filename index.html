<!DOCTYPE html>
<html lang="de">
<head>
	<link rel="manifest" href="manifest.json">
	
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	<link rel="stylesheet" href="/AufnameApp/css/style.css"> <!-- Gleiche CSS Datei -->
	
	<!-- Zuerst fields.js einbinden -->
	<script src="/AufnameApp/js/fields.js"></script>
	<!-- Dann speicher.js einbinden -->
	<script src="/AufnameApp/js/speicher.js"></script>
	<!-- SchlieÃŸlich createLocation.js einbinden -->
	<script src="/AufnameApp/js/createLocation.js"></script>

	<title>Ãœbersicht</title>
</head>
	
<body>

    <h1>Standortauswahl</h1>
<p>


    <!-- Buttons fÃ¼r die Standort-Verwaltung -->
    <button id="newLocationButton">Neuen Standort erstellen</button>
    <button id="editLocationButton" onclick="document.getElementById('uploadJson').click()">Standort bearbeiten</button>

    <!-- Unsichtbarer File-Input fÃ¼r den JSON-Upload -->
    <input type="file" id="uploadJson" accept=".json" style="display: none;">
		
	<!-- Button zur Unterseite -->
	<button class="side-button" onclick="window.location.href='Unterkategorien/Grundriss.html'">Grundriss</button> 
	<button class="side-button" onclick="window.location.href='Unterkategorien/Hausanschluss.html'">Energieversorgung</button>
	<button class="side-button" onclick="window.location.href='Unterkategorien/Energieverteilung.html'">Energieverteilung</button>
	<button class="side-button" onclick="window.location.href='Unterkategorien/Standort.html'">Standort</button>

	<button id="update-btn" style="position: fixed; bottom: 20px; right: 20px; padding: 10px; background-color: blue; color: white; border: none; border-radius: 5px; cursor: pointer;">
	  Aktualisieren ðŸ”„
	</button>

<script>
  document.getElementById('update-btn').addEventListener('click', () => {
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistration().then(reg => {
        if (reg && reg.waiting) {
          // Falls ein neuer Service Worker wartet, diesen aktivieren
          reg.waiting.postMessage({ action: 'skipWaiting' });
        } else {
          // Falls kein neuer SW vorhanden, einfach Seite neu laden
          window.location.reload();
        }
      });
    } else {
      window.location.reload(); // Falls kein SW, einfach neuladen
    }
  });

  // Falls der neue Service Worker aktiviert wird, Seite neuladen
  if (navigator.serviceWorker) {
    navigator.serviceWorker.addEventListener('controllerchange', () => {
      window.location.reload();
    });
  }
</script>

	
	
<script>
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js')
    .then(() => console.log('Service Worker registriert'))
    .catch(error => console.log('Service Worker Registrierung fehlgeschlagen:', error));
}
// JSON upload handler: read file, extract 'location', store and navigate
document.getElementById('uploadJson').addEventListener('change', function(event) {
  const file = event.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const data = JSON.parse(e.target.result);
      const locationValue = data.location ?? data.Location ?? data.name ?? null;
      if (locationValue) {
        sessionStorage.setItem('editLocationName', locationValue);
        // also save the full JSON so other pages can access more fields if needed
        try { sessionStorage.setItem('editLocationJson', JSON.stringify(data)); } catch (e) { /* ignore */ }
        window.location.href = 'Unterkategorien/Standort.html';
      } else {
        alert('Keine "location"-Eigenschaft in der JSON-Datei gefunden.');
      }
    } catch (err) {
      alert('Fehler beim Einlesen der JSON-Datei: ' + err.message);
    }
  };
  reader.readAsText(file);
});
</script>

</body>
</html>





